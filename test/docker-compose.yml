version: "3.8"
services: 
    database:
        container_name: "pirogue-database-instance"
        image: mariadb:latest
        environment:
            - MYSQL_ROOT_PASSWORD=root-password
            - MYSQL_USER=website-user
            - MYSQL_PASSWORD=website-password
            - MYSQL_DATABASE=website
        volumes:
            - ./container/database-create.sql:/docker-entrypoint-initdb.d/00-database-create.sql:ro
        ports:
            - 3306:3306
        restart: always        

    php-test:
        container_name: "pirogue-test-instance"
        image: "pirogue-test"
        environment:
            - EXECUTE_TEST=${EXECUTE_TEST:-3}
        build: 
            context: ./container
            dockerfile: Containerfile-unit_testing
        volumes:
            - ./unit-tests:/var/pirogue-testing/test:rw
            - ./config:/var/pirogue-testing/config:rw
            - ./view:/var/pirogue-testing/view:rw
            - ${PIROGUE_PATH}:-../src}/pirogue:/var/pirogue-testing/include/pirogue:rw           
        depends_on:
            - database
        links:
            - database        
